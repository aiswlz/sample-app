name: CI/CD Pipeline

on:
  push:
    branches: [ "main" ]
  pull_request:
    branches: [ "main" ]

jobs:
  build-and-test:
    runs-on: ubuntu-latest

    steps:
    - name: üßæ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      uses: actions/checkout@v3

    - name: üêç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Python
      uses: actions/setup-python@v4
      with:
        python-version: '3.9'

    - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ backend
      run: |
        cd sample-app/backend
        pip install -r requirements.txt

    - name: ‚úÖ –ó–∞–ø—É—Å—Ç–∏—Ç—å —Ç–µ—Å—Ç—ã backend
      run: |
        cd sample-app/backend
        pytest

    - name: üß∞ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Node.js
      uses: actions/setup-node@v3
      with:
        node-version: '18'

    - name: üì¶ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ frontend –∏ —Å–æ–±—Ä–∞—Ç—å
      run: |
        cd sample-app/frontend
        npm install
        npm run build

  deploy:
    needs: build-and-test
    runs-on: ubuntu-latest

    steps:
    - name: üßæ –ö–ª–æ–Ω–∏—Ä–æ–≤–∞—Ç—å —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π
      uses: actions/checkout@v3

    - name: üê≥ –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å Docker Compose –∏ —Ä–∞–∑–≤–µ—Ä–Ω—É—Ç—å
      run: |
        docker-compose up -d --build
